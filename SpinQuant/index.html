<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>SpinQuant | Sunset</title>
<meta name="keywords" content="Quantization, Paper">
<meta name="description" content="학습가능한 Rotation matrix을 이용한 Quantization">
<meta name="author" content="">
<link rel="canonical" href="https://new-sunset-shimmer.github.io/SpinQuant/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://new-sunset-shimmer.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://new-sunset-shimmer.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://new-sunset-shimmer.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://new-sunset-shimmer.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://new-sunset-shimmer.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://new-sunset-shimmer.github.io/SpinQuant/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><style>
    @media screen and (min-width: 769px) {

         
        .post-content input[type="checkbox"]:checked~label>img {
            transform: scale(1.6);
            cursor: zoom-out;
            position: relative;
            z-index: 999;
        }

        .post-content img.zoomCheck {
            transition: transform 0.15s ease;
            z-index: 999;
            cursor: zoom-in;
        }
    }
</style><meta property="og:title" content="SpinQuant" />
<meta property="og:description" content="학습가능한 Rotation matrix을 이용한 Quantization" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://new-sunset-shimmer.github.io/SpinQuant/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-12-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-12-12T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SpinQuant"/>
<meta name="twitter:description" content="학습가능한 Rotation matrix을 이용한 Quantization"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://new-sunset-shimmer.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "SpinQuant",
      "item": "https://new-sunset-shimmer.github.io/SpinQuant/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "SpinQuant",
  "name": "SpinQuant",
  "description": "학습가능한 Rotation matrix을 이용한 Quantization",
  "keywords": [
    "Quantization", "Paper"
  ],
  "articleBody": " Full Title : SpinQuant: LLM Quantization with Learned Rotations\nLink : 2405.16406 (arxiv.org)\nReleased Date : 2024 10 07\nReview Date : 2024 10 22\n학습가능한 Rotation matrix을 이용한 Quantization\nMotivation PTQ는 따로 학습이 필요없이 모델의 사이즈와 계산량을 줄일수있는 장점이있다. 하지만 “Outlier”라는 중요한 벡터에 인해서 방법론에 인한 성능저하에 인해서 과연 효과적인지 의문을 가질수있다. 이번 논문은 Rotation matrix을 이용하여 outlier를 제어하여 Quantize에 보다 쉽게 만드는게 목표다. Research questions Rotation을 양자화의 성능을 최대로 만드는 최적화가 가능한가? Methodology 해당 논문에서는 R_1 R_2 R_3 R_4라는 다양한 Rotation matrix을 아키텍쳐에 적용시켰다. R_1과 R_2는 학습 가중치, R_3 R_4는 hadamard rotation matrix이다. Rotation은 외부에서 가중치에 전혀 흡수되지 않음으로 따로 Hadamard를 적용시킨거다. 해당 논문에서는 R_1, R_2를 무작위로 초기화하는게 가장 좋다고 판단했다. 하지만 아래의 그림에서 확인 가능하다싶이 그 Variance가 지나치게 높다 해당 문제를 해결하기 위해서 저자들은 Cayley-optimized rotation이라는 Rotation 전용 최적화 방법을 제안했다.\nStiefel 다양체는 정규 직교 행렬들이 구성하는 공간으로, 정규 직교 행렬의 모든 열이 서로 직교하며 각 열의 크기는 1입니다. 정규 직교 행렬은 회전이나 반사를 표현하는 데 사용되며, Cayley 변환은 이 행렬이 가질 수 있는 구조를 유지하면서 최적화를 수행할 수 있게 합니다.\n예를 들어, 양자화를 수행할 때 모델의 가중치나 활성화 값이 특정 축에 따라 비정상적으로 큰 값을 갖는 이상치가 있을 수 있습니다. Stiefel 다양체 상에서 회전 행렬을 최적화하면 이러한 이상치를 분산시켜 양자화 범위 안에 더 잘 맞추도록 만들어 줍니다. 이때 Stiefel 다양체의 정규 직교성을 유지해야 하기 때문에, 일반적인 최적화 방식이 아닌 특수한 방법이 필요하게 됩니다.\nCayley-optimized rotation의 역할\nCayley-optimized rotation을 통해 학습된 회전 행렬은 가중치와 활성화 값의 이상치를 줄이고 양자화 과정에서 발생하는 오류를 최소화할 수 있습니다. 예를 들어, 원래는 큰 값 하나 때문에 양자화가 비효율적으로 이루어질 수 있지만, Cayley-optimized rotation을 적용하면 각 축에 대한 분포가 보다 고르게 되어 양자화 효율성이 높아집니다.\n최적화 과정 요약 초기화: Cayley 변환을 이용해 회전 행렬을 초기화합니다. 초기 값으로는 일반적으로 Hadamard 행렬이나 무작위 직교 행렬을 사용합니다.\n회전 행렬 업데이트: Cayley 변환을 통해 그래디언트를 기반으로 회전 행렬을 업데이트하여 이상치가 줄어들도록 최적화합니다.\n양자화 수행: 최적화된 회전 행렬을 모델에 적용하여 양자화 범위 내에 더 많은 가중치와 활성화 값을 균등하게 분산시키고, 양자화 오류를 최소화합니다.\nMain result R_1, R_2를 무작위 hadamard martix으로서 초기화, GPTQ를 사용하여 quantization. SpinQuant no had는 R_1과 R_2만 사용 FP rotation과 Hadamard rotation의 차이 Personal thought Softmax층의 Rotation만 남겨도 성능이 좋을까?\nRotation을 다른 데이터 셋에 학습 시킬경우?\n",
  "wordCount" : "361",
  "inLanguage": "en",
  "datePublished": "2024-12-12T00:00:00Z",
  "dateModified": "2024-12-12T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://new-sunset-shimmer.github.io/SpinQuant/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sunset",
    "logo": {
      "@type": "ImageObject",
      "url": "https://new-sunset-shimmer.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://new-sunset-shimmer.github.io/" accesskey="h" title="Sunset (Alt + H)">Sunset</a>
            <div class="logo-switches">
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://new-sunset-shimmer.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://new-sunset-shimmer.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://new-sunset-shimmer.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://new-sunset-shimmer.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      SpinQuant
    </h1>
    <div class="post-meta"><span title='2024-12-12 00:00:00 +0000 UTC'>December 12, 2024</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#motivation" aria-label="Motivation">Motivation</a></li>
                <li>
                    <a href="#research-questions" aria-label="Research questions">Research questions</a></li>
                <li>
                    <a href="#methodology" aria-label="Methodology">Methodology</a></li>
                <li>
                    <a href="#%ec%b5%9c%ec%a0%81%ed%99%94-%ea%b3%bc%ec%a0%95-%ec%9a%94%ec%95%bd" aria-label="최적화 과정 요약">최적화 과정 요약</a></li>
                <li>
                    <a href="#main-result" aria-label="Main result">Main result</a></li>
                <li>
                    <a href="#personal-thought" aria-label="Personal thought">Personal thought</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>Full Title : SpinQuant: LLM Quantization with Learned Rotations</p>
</blockquote>
<blockquote>
<p>Link : <a href="https://arxiv.org/pdf/2405.16406">2405.16406 (arxiv.org)</a></p>
</blockquote>
<blockquote>
<p>Released Date : 2024 10 07</p>
</blockquote>
<blockquote>
<p>Review Date : 2024 10 22</p>
</blockquote>
<p>학습가능한 Rotation matrix을 이용한 Quantization</p>
<h3 id="motivation">Motivation<a hidden class="anchor" aria-hidden="true" href="#motivation">#</a></h3>
<ul>
<li>PTQ는 따로 학습이 필요없이 모델의 사이즈와 계산량을 줄일수있는 장점이있다. 하지만 “Outlier”라는 중요한 벡터에 인해서 방법론에 인한 성능저하에 인해서 과연 효과적인지 의문을 가질수있다. 이번 논문은 Rotation matrix을 이용하여 outlier를 제어하여 Quantize에 보다 쉽게 만드는게 목표다.</li>
</ul>
<h3 id="research-questions">Research questions<a hidden class="anchor" aria-hidden="true" href="#research-questions">#</a></h3>
<ul>
<li>Rotation을 양자화의 성능을 최대로 만드는 최적화가 가능한가?</li>
</ul>
<h3 id="methodology">Methodology<a hidden class="anchor" aria-hidden="true" href="#methodology">#</a></h3>
<ul>
<li>해당 논문에서는 R_1 R_2 R_3 R_4라는 다양한 Rotation matrix을 아키텍쳐에 적용시켰다. R_1과 R_2는 학습 가중치, R_3 R_4는 hadamard rotation matrix이다. Rotation은 외부에서 가중치에 전혀 흡수되지 않음으로 따로 Hadamard를 적용시킨거다.</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-38ac7" hidden>
<label for="zoomCheck-38ac7">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-80b5-8760-e244a3da52aa.png#center" alt=""  />
</label></p>
<ul>
<li>해당 논문에서는 R_1, R_2를 무작위로 초기화하는게 가장 좋다고 판단했다. 하지만 아래의 그림에서 확인 가능하다싶이 그 Variance가 지나치게 높다</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-ac816" hidden>
<label for="zoomCheck-ac816">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/e572eac9-cd3f-424a-b00f-cc149c952810.png#center" alt=""  />
</label></p>
<ul>
<li>
<p>해당 문제를 해결하기 위해서 저자들은 Cayley-optimized rotation이라는 Rotation 전용 최적화 방법을 제안했다.</p>
<p>Stiefel 다양체는 <strong>정규 직교 행렬들이 구성하는 공간</strong>으로, 정규 직교 행렬의 모든 열이 서로 직교하며 각 열의 크기는 1입니다. 정규 직교 행렬은 회전이나 반사를 표현하는 데 사용되며, Cayley 변환은 이 행렬이 가질 수 있는 구조를 유지하면서 최적화를 수행할 수 있게 합니다.</p>
<p>예를 들어, 양자화를 수행할 때 모델의 가중치나 활성화 값이 특정 축에 따라 비정상적으로 큰 값을 갖는 이상치가 있을 수 있습니다. Stiefel 다양체 상에서 회전 행렬을 최적화하면 이러한 이상치를 분산시켜 양자화 범위 안에 더 잘 맞추도록 만들어 줍니다. 이때 Stiefel 다양체의 정규 직교성을 유지해야 하기 때문에, 일반적인 최적화 방식이 아닌 특수한 방법이 필요하게 됩니다.</p>
</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-e0fd4" hidden>
<label for="zoomCheck-e0fd4">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-80f2-97df-e757bad30600.png#center" alt=""  />
</label></p>
<p>

<input type="checkbox" id="zoomCheck-4a29c" hidden>
<label for="zoomCheck-4a29c">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-804b-be34-f435d9b1d948.png#center" alt=""  />
</label></p>
<p>

<input type="checkbox" id="zoomCheck-ffd68" hidden>
<label for="zoomCheck-ffd68">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-8040-9142-f7cba5dcf5a8.png#center" alt=""  />
</label></p>
<ul>
<li>
<p>Cayley-optimized rotation의 역할</p>
<p>Cayley-optimized rotation을 통해 학습된 회전 행렬은 <strong>가중치와 활성화 값의 이상치를 줄이고 양자화 과정에서 발생하는 오류를 최소화</strong>할 수 있습니다. 예를 들어, 원래는 큰 값 하나 때문에 양자화가 비효율적으로 이루어질 수 있지만, Cayley-optimized rotation을 적용하면 각 축에 대한 분포가 보다 고르게 되어 양자화 효율성이 높아집니다.</p>
<h3 id="최적화-과정-요약">최적화 과정 요약<a hidden class="anchor" aria-hidden="true" href="#최적화-과정-요약">#</a></h3>
<ol>
<li>
<p><strong>초기화</strong>: Cayley 변환을 이용해 회전 행렬을 초기화합니다. 초기 값으로는 일반적으로 Hadamard 행렬이나 무작위 직교 행렬을 사용합니다.</p>
</li>
<li>
<p><strong>회전 행렬 업데이트</strong>: Cayley 변환을 통해 그래디언트를 기반으로 회전 행렬을 업데이트하여 이상치가 줄어들도록 최적화합니다.</p>
</li>
<li>
<p><strong>양자화 수행</strong>: 최적화된 회전 행렬을 모델에 적용하여 양자화 범위 내에 더 많은 가중치와 활성화 값을 균등하게 분산시키고, 양자화 오류를 최소화합니다.</p>
</li>
</ol>
</li>
</ul>
<h3 id="main-result">Main result<a hidden class="anchor" aria-hidden="true" href="#main-result">#</a></h3>
<ul>
<li>R_1, R_2를 무작위 hadamard martix으로서 초기화, GPTQ를  사용하여 quantization. SpinQuant no had는 R_1과 R_2만 사용</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-ea847" hidden>
<label for="zoomCheck-ea847">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-80ae-975d-eafe01101427.png#center" alt=""  />
</label></p>
<hr>
<p>

<input type="checkbox" id="zoomCheck-6ac90" hidden>
<label for="zoomCheck-6ac90">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-8014-9c70-dd86319a7ed6.png#center" alt=""  />
</label></p>
<ul>
<li>FP rotation과 Hadamard rotation의 차이</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-c9623" hidden>
<label for="zoomCheck-c9623">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-8017-893b-dd07d98f054f.png#center" alt=""  />
</label></p>
<h3 id="personal-thought">Personal thought<a hidden class="anchor" aria-hidden="true" href="#personal-thought">#</a></h3>
<ol>
<li>
<p>Softmax층의 Rotation만 남겨도 성능이 좋을까?</p>
</li>
<li>
<p>Rotation을 다른 데이터 셋에 학습 시킬경우?</p>
</li>
</ol>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://new-sunset-shimmer.github.io/tags/quantization/">Quantization</a></li>
      <li><a href="https://new-sunset-shimmer.github.io/tags/paper/">Paper</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://new-sunset-shimmer.github.io/">Sunset</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
