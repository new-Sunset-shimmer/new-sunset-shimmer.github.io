<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>QLLM | Sunset</title>
<meta name="keywords" content="Quantization, Paper">
<meta name="description" content="Splitting outlier to sub channels">
<meta name="author" content="">
<link rel="canonical" href="https://new-sunset-shimmer.github.io/QLLM/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5cfc680b1eeaeef9efbced92d46c2a9e876b72ee14fba85846afc4cff9e6e6f8.css" integrity="sha256-XPxoCx7q7vnvvO2S1Gwqnodrcu4U&#43;6hYRq/Ez/nm5vg=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://new-sunset-shimmer.github.io/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://new-sunset-shimmer.github.io/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://new-sunset-shimmer.github.io/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://new-sunset-shimmer.github.io/apple-touch-icon.png">
<link rel="mask-icon" href="https://new-sunset-shimmer.github.io/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://new-sunset-shimmer.github.io/QLLM/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><style>
    @media screen and (min-width: 769px) {

         
        .post-content input[type="checkbox"]:checked~label>img {
            transform: scale(1.6);
            cursor: zoom-out;
            position: relative;
            z-index: 999;
        }

        .post-content img.zoomCheck {
            transition: transform 0.15s ease;
            z-index: 999;
            cursor: zoom-in;
        }
    }
</style><meta property="og:title" content="QLLM" />
<meta property="og:description" content="Splitting outlier to sub channels" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://new-sunset-shimmer.github.io/QLLM/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-12-12T00:00:00+00:00" />
<meta property="article:modified_time" content="2024-12-12T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="QLLM"/>
<meta name="twitter:description" content="Splitting outlier to sub channels"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://new-sunset-shimmer.github.io/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "QLLM",
      "item": "https://new-sunset-shimmer.github.io/QLLM/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "QLLM",
  "name": "QLLM",
  "description": "Splitting outlier to sub channels",
  "keywords": [
    "Quantization", "Paper"
  ],
  "articleBody": " Full Title : QLLM: ACCURATE AND EFFICIENT LOW-BITWIDTH QUANTIZATION FOR LARGE LANGUAGE MODELS\nLink : 2310.08041 (arxiv.org)\nRelated Link :\nReleased Date : Thu, 12 Oct 2023\nReview Date : Thu, 5 Dec 2024\nSplitting outlier to sub channels\nMotivation Outlier(huge magnitude value) make quantization harder. In this paper authors distribute huge magnitude to all over layers. Author can make outliers more smoother than SmoothQuant Research questions Can we make outlier smoother ? Methodology ADAPTIVE CHANNEL REASSEMBLY\nFor distribute input’s outlier to multiple channel consists of three components. 1) decompose 2) assembling for balancing the efficiency 3) Adaptively find reassembly ratio for each layer\nCHANNEL DISASSEMBLY Authors splitting outlier to T - 1 sub-channels and adding them. this equation equivalent with original but more quantization friendly .\nT is determined by threshold value θ. [T = ⌈max(|xM|)/θ⌉.]\nCHANNEL ASSEMBLY But from Channel disassembly Total channel count increased to M + T - 1. for maintaining efficiency and speed prune channels. Prune unimportant channels directly but this method make loss unstable(also gradient). Authors use combining T - 1 similar tokens inorder to preserve total channel counts\nWe can aggregate channels by above equation. Average of their input features, Wik + Wjk is merged weights\n∥·∥2 represents the ℓ2 norm. we minimizing the information loss of two weight.\nafter calculate all channels determine which channels to aggregate efficiently use Bipartite soft matching but not assemble outlier channels\nADAPTIVE REASSEMBLY for find optimal θ authors solve equation 6 by grid search\nEFFICIENT GRADIENT-BASED ERROR CORRECTION\nfor make assembled weight more powerful authors train low rank AB in small amount calibrated dataset.\nlearn the introduced low-rank parameters by minimizing the reconstruction error between the original and the quantized outputs of the Attention-FFN block\nand store only quantized weight.\nMain result use per-channel weight quantization and per-token activation quantization. we quantize all weights and intermediate activations, with the exception of the Softmax output probability\nQLLM begins by applying channel reassembly prior to all linear projection layers, excluding the attention output projection layer, followed by performing error correction on the resulting model. The rank r of the introduced low-rank parameters is set to 4, and these parameters are trained for 10 epochs with a mini-batch size of 1. We carry out the reconstruction using 4 Attention-FFN blocks. use AdamW with lr 5 x 10^-4\nPerformance of QLLM Performance on channel each method. Channel expansion ration is parameter that how much expand channel by delta. Throughtput TQW which tunes all quantized weights, EEC focuses on learning a small set of low-rank weights Personal thought why it is working ? just splitting outliers and quantize them is sound unstable and make no sound but it is working ",
  "wordCount" : "449",
  "inLanguage": "en",
  "datePublished": "2024-12-12T00:00:00Z",
  "dateModified": "2024-12-12T00:00:00Z",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://new-sunset-shimmer.github.io/QLLM/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Sunset",
    "logo": {
      "@type": "ImageObject",
      "url": "https://new-sunset-shimmer.github.io/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://new-sunset-shimmer.github.io/" accesskey="h" title="Sunset (Alt + H)">Sunset</a>
            <div class="logo-switches">
                <ul class="lang-switch"><li>|</li>
                </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://new-sunset-shimmer.github.io/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="https://new-sunset-shimmer.github.io/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="https://new-sunset-shimmer.github.io/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
            <li>
                <a href="https://new-sunset-shimmer.github.io/about/" title="About">
                    <span>About</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      QLLM
    </h1>
    <div class="post-meta"><span title='2024-12-12 00:00:00 +0000 UTC'>December 12, 2024</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#motivation" aria-label="Motivation">Motivation</a></li>
                <li>
                    <a href="#research-questions" aria-label="Research questions">Research questions</a></li>
                <li>
                    <a href="#methodology" aria-label="Methodology">Methodology</a></li>
                <li>
                    <a href="#main-result" aria-label="Main result">Main result</a></li>
                <li>
                    <a href="#personal-thought" aria-label="Personal thought">Personal thought</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><blockquote>
<p>Full Title : QLLM: ACCURATE AND EFFICIENT LOW-BITWIDTH QUANTIZATION FOR LARGE LANGUAGE MODELS</p>
</blockquote>
<blockquote>
<p>Link : <a href="https://arxiv.org/pdf/2310.08041">2310.08041 (arxiv.org)</a></p>
</blockquote>
<blockquote>
<p>Related Link :</p>
</blockquote>
<blockquote>
<p>Released Date :  Thu, 12 Oct 2023</p>
</blockquote>
<blockquote>
<p>Review Date : Thu, 5 Dec 2024</p>
</blockquote>
<p>Splitting outlier to sub channels</p>
<h3 id="motivation">Motivation<a hidden class="anchor" aria-hidden="true" href="#motivation">#</a></h3>
<ul>
<li>Outlier(huge magnitude value) make quantization harder. In this paper authors distribute huge magnitude to all over layers. Author can make outliers more smoother than SmoothQuant</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-43719" hidden>
<label for="zoomCheck-43719">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-80de-9747-df4257da0b11.png#center" alt=""  />
</label></p>
<h3 id="research-questions">Research questions<a hidden class="anchor" aria-hidden="true" href="#research-questions">#</a></h3>
<ul>
<li>Can we make outlier smoother ?</li>
</ul>
<h3 id="methodology">Methodology<a hidden class="anchor" aria-hidden="true" href="#methodology">#</a></h3>
<ul>
<li>
<p>ADAPTIVE CHANNEL REASSEMBLY</p>
<p>For distribute input’s outlier to multiple channel consists of three components. 1) decompose 2) assembling for balancing the efficiency 3) Adaptively find reassembly ratio for each layer</p>
<ul>
<li>CHANNEL DISASSEMBLY</li>
</ul>
</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-555a2" hidden>
<label for="zoomCheck-555a2">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/52451ccf-18fc-4db9-86cc-f6f5e3f4df05.png#center" alt=""  />
</label></p>
<p>Authors splitting outlier to T - 1 sub-channels and adding them. this equation equivalent with original but more quantization friendly .</p>
<p>T is determined by threshold value θ. [T = ⌈max(|xM|)/θ⌉.]</p>
<ul>
<li>CHANNEL ASSEMBLY</li>
</ul>
<p>But from Channel disassembly Total channel count increased to M + T - 1. for maintaining efficiency and speed prune channels. Prune unimportant channels directly but this method make loss unstable(also gradient). Authors use combining T - 1 similar tokens inorder to preserve total channel counts</p>
<p>

<input type="checkbox" id="zoomCheck-97335" hidden>
<label for="zoomCheck-97335">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/216f5662-53ab-42d1-9a01-ad27d54b04aa.png#center" alt=""  />
</label></p>
<p>We can aggregate channels by above equation. Average of their input features, Wik + Wjk is merged weights</p>
<p>

<input type="checkbox" id="zoomCheck-c32fa" hidden>
<label for="zoomCheck-c32fa">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/71c7f179-54cd-447a-95fd-e16fd2527d87.png#center" alt=""  />
</label></p>
<p>∥·∥2 represents the ℓ2 norm. we minimizing the information loss of two weight.</p>
<p>after calculate all channels determine which channels to aggregate efficiently use Bipartite soft matching but not assemble outlier channels</p>
<p>

<input type="checkbox" id="zoomCheck-1cb75" hidden>
<label for="zoomCheck-1cb75">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/0bf5a1fd-5731-4862-92ee-8c09646ef94f.png#center" alt=""  />
</label></p>
<ul>
<li>ADAPTIVE REASSEMBLY</li>
</ul>
<p>for find optimal θ authors solve equation 6 by grid search</p>
<p>

<input type="checkbox" id="zoomCheck-f94ba" hidden>
<label for="zoomCheck-f94ba">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/3449a916-f54c-4a37-a9ae-8cc64e89c5c0.png#center" alt=""  />
</label></p>
<p>

<input type="checkbox" id="zoomCheck-c8ab2" hidden>
<label for="zoomCheck-c8ab2">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15448a24-99a5-4bb0-8221-559127853f82.png#center" alt=""  />
</label></p>
<ul>
<li>
<p>EFFICIENT GRADIENT-BASED ERROR CORRECTION</p>
<p>for make assembled weight more powerful authors train low rank AB in small amount calibrated dataset.</p>
<p>learn the introduced low-rank parameters by minimizing the reconstruction error between the original and the quantized outputs of the Attention-FFN block</p>
</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-ccf16" hidden>
<label for="zoomCheck-ccf16">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/199aaaac-03cf-4ff4-8795-c897d054e156.png#center" alt=""  />
</label></p>
<p>and store only quantized weight.</p>
<p>

<input type="checkbox" id="zoomCheck-67113" hidden>
<label for="zoomCheck-67113">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/e9f47a0b-8718-4b2e-a400-090d846e53b8.png#center" alt=""  />
</label></p>
<h3 id="main-result">Main result<a hidden class="anchor" aria-hidden="true" href="#main-result">#</a></h3>
<p>use per-channel weight quantization and per-token activation quantization. we quantize all weights and intermediate activations, with the exception of the Softmax output probability</p>
<p>QLLM begins by applying channel reassembly prior to all linear projection layers, excluding the attention output projection layer, followed by performing error correction on the resulting model. The rank r of the introduced low-rank parameters is set to 4, and these parameters are trained for 10 epochs with a mini-batch size of 1. We carry out the reconstruction using 4 Attention-FFN blocks. use AdamW with lr 5 x 10^-4</p>
<ul>
<li>Performance of QLLM</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-dfefe" hidden>
<label for="zoomCheck-dfefe">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-80e2-8d7f-dc597fa67b8e.png#center" alt=""  />
</label></p>
<ul>
<li>Performance on channel each method. Channel expansion ration is parameter that how much expand channel by delta.</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-31c9d" hidden>
<label for="zoomCheck-31c9d">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-80b4-976b-e0fdb57e1e9b.png#center" alt=""  />
</label></p>
<ul>
<li>Throughtput</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-ccc46" hidden>
<label for="zoomCheck-ccc46">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/8cbe7efb-df62-4d8a-a0b5-12f85c80a6b2.png#center" alt=""  />
</label></p>
<ul>
<li>TQW which tunes all quantized weights, EEC focuses on learning a small set of low-rank weights</li>
</ul>
<p>

<input type="checkbox" id="zoomCheck-ddea7" hidden>
<label for="zoomCheck-ddea7">
    <img class="zoomCheck" loading="lazy" decoding="async" src="/images/15a415f9-e659-80e3-a21d-f80c73b94b25.png#center" alt=""  />
</label></p>
<h3 id="personal-thought">Personal thought<a hidden class="anchor" aria-hidden="true" href="#personal-thought">#</a></h3>
<ul>
<li>why it is working ? just splitting outliers and quantize them is sound unstable and make no sound but it is working</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://new-sunset-shimmer.github.io/tags/quantization/">Quantization</a></li>
      <li><a href="https://new-sunset-shimmer.github.io/tags/paper/">Paper</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://new-sunset-shimmer.github.io/">Sunset</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
